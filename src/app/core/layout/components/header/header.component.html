<header class="aso-header">
  <div class="logo">
    <img src="assets/escudo.png" alt="Logo" />
    <h1 class="logo-title">ASO</h1>
  </div>

  <nav class="nav-bar">
    <button 
      class="hamburger" 
      aria-label="Toggle navigation" 
      type="button"
      (click)="toggleMobileNav()"
      [attr.aria-expanded]="isMobileNavOpen"
    >
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <ul class="nav-list" [class.nav-list--open]="isMobileNavOpen">
      <li class="nav-item">
        <a routerLink="/home" routerLinkActive="active" (click)="closeAllMenus()">
          Início
        </a>
      </li>

      <li class="nav-item">
        <a routerLink="/personagens" routerLinkActive="active" (click)="closeAllMenus()">
          Personagens
        </a>
      </li>

      <li class="nav-item">
        <a routerLink="/campanhas" routerLinkActive="active" (click)="closeAllMenus()">
          Campanhas
        </a>
      </li>
    </ul>
  </nav>

  <div class="user-section">
    <!-- Usuário Logado -->
    <div *ngIf="isLoggedIn" class="user-wrapper">
      <div class="user-info">
        <span class="username">{{ username }}</span>
        <span class="player-name" *ngIf="playerName">{{ playerName }}</span>
      </div>
      
      <aso-avatar 
        [src]="userPhotoUrl"
        [alt]="username"
        size="sm"
        [fallback]="username ? username.charAt(0).toUpperCase() : 'U'"
        (avatarClick)="toggleUserMenu()"
        [attr.aria-expanded]="isUserMenuOpen"
        [attr.aria-haspopup]="true"
      ></aso-avatar>

      <!-- Menu inline abaixo do avatar -->
      <div 
        class="user-menu" 
        [class.user-menu--open]="isUserMenuOpen"
        role="menu"
        [attr.aria-hidden]="!isUserMenuOpen"
      >
        <button 
          type="button" 
          class="user-menu__item"
          role="menuitem"
          (click)="goToProfile(); closeAllMenus()"
        >
          <span class="user-menu__icon pi pi-user"></span>
          Perfil
        </button>

        <hr class="user-menu__divider" />

        <button 
          type="button" 
          class="user-menu__item"
          role="menuitem"
          (click)="goToFriends(); closeAllMenus()"
        >
          <span class="user-menu__icon pi pi-users"></span>
          Meus Amigos
          <span *ngIf="pendingRequestsCount > 0" class="user-menu__badge" pBadge [value]="pendingRequestsCount.toString()" severity="danger"></span>
        </button>

        <hr class="user-menu__divider" />

        <button 
          type="button" 
          class="user-menu__item"
          role="menuitem"
          (click)="toggleTheme(); closeAllMenus()"
        >
          <span class="user-menu__icon pi pi-palette"></span>
          Tema
        </button>

        <hr class="user-menu__divider" />

        <button 
          type="button" 
          class="user-menu__item user-menu__item--danger"
          role="menuitem"
          (click)="onLogout()"
        >
          <span class="user-menu__icon pi pi-sign-out"></span>
          Sair
        </button>
      </div>
    </div>

    <!-- Botão de Login -->
    <button 
      *ngIf="!isLoggedIn"
      type="button"
      pButton
      label="Entrar"
      icon="pi pi-sign-in"
      severity="primary"
      (click)="onLogin()"
    ></button>
  </div>
</header>
